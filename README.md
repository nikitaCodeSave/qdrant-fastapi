# ğŸš€ Qdrant RAG Service

ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğ¹ FastAPI ÑĞµÑ€Ğ²Ğ¸Ñ Ğ´Ğ»Ñ RAG-ÑĞ¸ÑÑ‚ĞµĞ¼ Ñ Qdrant Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ğ¾Ğ¹ Ğ±Ğ°Ğ·Ğ¾Ğ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….

## ğŸ“ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

**Ğ”Ğ¾Ğ¼ĞµĞ½Ğ½Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°** Ñ Ğ¿Ñ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ğ¾Ğ¼ "Thin Router, Thick Service":

```
src/
â”œâ”€â”€ main.py                 # Ğ¢Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ°, lifespan, exception handlers
â”œâ”€â”€ config.py               # Pydantic Settings
â”‚
â”œâ”€â”€ shared/                 # ĞĞ±Ñ‰Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
â”‚   â”œâ”€â”€ exceptions.py       # Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ (DomainError, NotFoundError)
â”‚   â””â”€â”€ schemas.py          # ĞĞ±Ñ‰Ğ¸Ğµ ÑÑ…ĞµĞ¼Ñ‹ (ErrorResponse, Pagination)
â”‚
â””â”€â”€ qdrant/                 # ğŸ¯ Ğ”Ğ¾Ğ¼ĞµĞ½ Qdrant
    â”œâ”€â”€ __init__.py         # Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€Ğ°
    â”œâ”€â”€ constants.py        # ĞšĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ñ‹ (Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹, defaults)
    â”œâ”€â”€ schemas.py          # Pydantic DTOs
    â”œâ”€â”€ exceptions.py       # Ğ”Ğ¾Ğ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ
    â”œâ”€â”€ client.py           # Qdrant ĞºĞ»Ğ¸ĞµĞ½Ñ‚ (singleton)
    â”œâ”€â”€ service.py          # â­ Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
    â”œâ”€â”€ router.py           # HTTP endpoints (Ñ‚Ğ¾Ğ½ĞºĞ¸Ğ¹!)
    â””â”€â”€ dependencies.py     # DI Ñ†ĞµĞ¿Ğ¾Ñ‡ĞºĞ°
```

## ğŸ”„ Ğ¢Ñ€Ñ‘Ñ…ÑĞ»Ğ¾Ğ¹Ğ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ROUTER (Thin)                         â”‚
â”‚  â€¢ Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ request (Pydantic)                         â”‚
â”‚  â€¢ Ğ’Ñ‹Ğ·Ğ¾Ğ² service Ñ‡ĞµÑ€ĞµĞ· Depends()                        â”‚
â”‚  â€¢ HTTP ÑÑ‚Ğ°Ñ‚ÑƒÑ-ĞºĞ¾Ğ´Ñ‹                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ Depends(get_qdrant_service)
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 SERVICE (Business Logic)                 â”‚
â”‚  â€¢ Ğ’Ğ¡Ğ¯ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ·Ğ´ĞµÑÑŒ                              â”‚
â”‚  â€¢ Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»                              â”‚
â”‚  â€¢ Ğ’Ñ‹Ğ±Ñ€Ğ¾Ñ Ğ´Ğ¾Ğ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¹                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CLIENT (Data Access)                   â”‚
â”‚  â€¢ ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ Qdrant                                    â”‚
â”‚  â€¢ Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ»Ğ¸ None                           â”‚
â”‚  â€¢ ĞĞ˜ĞšĞĞšĞĞ™ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚

```bash
# 1. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°
python -m venv .venv && source .venv/bin/activate
pip install -e ".[dev]"

# 2. ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
cp .env.example .env

# 3. Ğ—Ğ°Ğ¿ÑƒÑĞº Qdrant (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾, Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ local mode)
docker run -p 6333:6333 -p 6334:6334 qdrant/qdrant

# 4. Ğ—Ğ°Ğ¿ÑƒÑĞº ÑĞµÑ€Ğ²Ğ¸ÑĞ°
uvicorn src.main:app --reload
```

## ğŸ“¡ API Endpoints

| ĞœĞµÑ‚Ğ¾Ğ´ | Endpoint | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|-------|----------|----------|
| GET | `/health` | Health check |
| GET | `/api/v1/qdrant/collections` | Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¹ |
| POST | `/api/v1/qdrant/collections` | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ñ |
| DELETE | `/api/v1/qdrant/collections/{name}` | Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ñ |
| POST | `/api/v1/qdrant/collections/{name}/points` | Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ñ‡ĞºÑƒ |
| POST | `/api/v1/qdrant/collections/{name}/points/batch` | Batch Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ |
| POST | `/api/v1/qdrant/collections/{name}/search` | Ğ’ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº |

## ğŸ§ª Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

```bash
pytest                      # Ğ’ÑĞµ Ñ‚ĞµÑÑ‚Ñ‹
pytest --cov=src           # Ğ¡ Ğ¿Ğ¾ĞºÑ€Ñ‹Ñ‚Ğ¸ĞµĞ¼
pytest -m "not slow"       # Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹
```

## ğŸ“ ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹

| ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|---------|----------|
| **Thin Router** | Ğ Ğ¾ÑƒÑ‚ĞµÑ€ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ HTTP, Ğ²ÑÑ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ² Service |
| **Domain Exceptions** | Service Ğ²Ñ‹Ğ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµÑ‚ DomainError, Ğ½Ğµ HTTPException |
| **DI Chain** | Ğ’ÑĞµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ñ‡ĞµÑ€ĞµĞ· FastAPI Depends |
| **Type Safety** | ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ñ‚Ğ¸Ğ¿Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ: Pydantic, type hints |
| **Async-First** | Ğ’ÑĞµ I/O Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğµ |