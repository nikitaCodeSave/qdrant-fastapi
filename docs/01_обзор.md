# Обзор проекта Qdrant RAG Service

## Введение

**Qdrant RAG Service** — асинхронный FastAPI микросервис для работы с векторной базой данных Qdrant. Сервис предназначен для построения RAG (Retrieval-Augmented Generation) систем и обеспечивает полный CRUD-функционал для управления коллекциями и точками (документами с векторами).

## Основные возможности

### Управление коллекциями
- Создание коллекций с настраиваемой размерностью векторов
- Поддержка метрик расстояния: Cosine, Euclid, Dot
- Получение информации о коллекциях
- Удаление коллекций

### Работа с точками (Points)
- Добавление точек (upsert) — единичное и batch
- Получение точек по ID
- Удаление точек
- Хранение метаданных (payload) вместе с векторами

### Векторный поиск
- Поиск k-ближайших соседей (k-NN)
- Фильтрация по полям payload
- Настраиваемый score threshold
- Возврат payload и/или векторов в результатах

### Мониторинг
- Health check endpoint
- Проверка состояния Qdrant
- Замер латентности

## Технологический стек

| Компонент | Технология | Версия |
|-----------|------------|--------|
| Web Framework | FastAPI | 0.124.4 |
| ASGI Server | Uvicorn | 0.38.0 |
| Vector Database | Qdrant | 1.16.2 |
| Validation | Pydantic | 2.12.5 |
| Settings | pydantic-settings | 2.12.0 |
| HTTP Client | httpx | 0.28.1 |

## Режимы работы

### 1. Server Mode (Docker)
Подключение к внешнему серверу Qdrant, запущенному в Docker:

```bash
docker run -p 6333:6333 -p 6334:6334 qdrant/qdrant
```

### 2. Local Mode (Embedded)
Использование встроенного Qdrant без Docker. Данные хранятся локально:

```env
QDRANT_LOCAL_PATH=./qdrant_storage
```

## Архитектурные принципы

| Принцип | Описание |
|---------|----------|
| **Thin Router** | Роутер занимается только HTTP, вся логика в Service |
| **Domain Exceptions** | Service выбрасывает DomainError, не HTTPException |
| **DI Chain** | Все зависимости через FastAPI Depends |
| **Type Safety** | Полная типизация: Pydantic, type hints |
| **Async-First** | Все I/O операции асинхронные |
| **Singleton Client** | Один клиент Qdrant на всё приложение |

## Структура проекта

```
src/
├── main.py                 # Точка входа, lifespan, exception handlers
├── config.py               # Pydantic Settings
│
├── shared/                 # Общие компоненты
│   ├── exceptions.py       # Базовые исключения (DomainError, NotFoundError)
│   └── schemas.py          # Общие схемы (ErrorResponse, Pagination)
│
└── qdrant/                 # Домен Qdrant
    ├── __init__.py         # Экспорт роутера
    ├── constants.py        # Константы (лимиты, defaults)
    ├── schemas.py          # Pydantic DTOs
    ├── exceptions.py       # Доменные исключения
    ├── client.py           # Qdrant клиент (singleton)
    ├── service.py          # Бизнес-логика
    ├── router.py           # HTTP endpoints (тонкий!)
    └── dependencies.py     # DI цепочка
```

## Быстрый старт

```bash
# 1. Клонирование и настройка
git clone <repo>
cd qdrant-FastApi
python -m venv .venv && source .venv/bin/activate
pip install -r requirements.txt

# 2. Конфигурация
cp .env.example .env

# 3. Запуск Qdrant (опционально — для Server Mode)
docker run -p 6333:6333 -p 6334:6334 qdrant/qdrant

# 4. Запуск сервиса
uvicorn src.main:app --reload
```

Документация API доступна по адресу: http://localhost:8000/docs

## Следующие шаги

- [Архитектура](02_архитектура.md) — подробное описание архитектуры
- [Установка](03_установка.md) — детальная инструкция по установке
- [Конфигурация](04_конфигурация.md) — все настройки сервиса
- [API Reference](05_api_reference.md) — описание всех endpoints
