# Установка и запуск

## Системные требования

- **Python**: 3.11+
- **Docker** (опционально): для запуска Qdrant в Server Mode
- **RAM**: минимум 2 GB (для Local Mode), 4+ GB рекомендуется
- **Disk**: зависит от объёма данных

## Клонирование проекта

```bash
git clone <repository-url>
cd qdrant-FastApi
```

## Создание виртуального окружения

### Linux / macOS

```bash
python -m venv .venv
source .venv/bin/activate
```

### Windows (PowerShell)

```powershell
python -m venv .venv
.venv\Scripts\Activate.ps1
```

### Windows (CMD)

```cmd
python -m venv .venv
.venv\Scripts\activate.bat
```

## Установка зависимостей

### Из requirements.txt

```bash
pip install -r requirements.txt
```

### Основные зависимости

| Пакет | Назначение |
|-------|------------|
| `fastapi[standard]` | Web framework + Uvicorn |
| `uvicorn[standard]` | ASGI сервер |
| `qdrant-client` | Клиент Qdrant |
| `pydantic` | Валидация данных |
| `pydantic-settings` | Конфигурация |
| `httpx` | Async HTTP клиент |

## Конфигурация

### 1. Создание .env файла

```bash
cp .env.example .env
```

### 2. Редактирование настроек

Откройте `.env` и настройте под ваше окружение:

```env
# Application
PROJECT_NAME="Qdrant RAG Service"
VERSION="0.1.0"
ENVIRONMENT=development

# Qdrant Connection
QDRANT_HOST=localhost
QDRANT_PORT=6333
```

Подробное описание всех параметров — в [Конфигурации](04_конфигурация.md).

## Режимы запуска Qdrant

### Вариант 1: Local Mode (без Docker)

Самый простой способ для разработки. Данные хранятся локально.

```env
QDRANT_LOCAL_PATH=./qdrant_storage
```

### Вариант 2: Docker (Server Mode)

```bash
# Запуск Qdrant
docker run -d \
  --name qdrant \
  -p 6333:6333 \
  -p 6334:6334 \
  -v $(pwd)/qdrant_storage:/qdrant/storage \
  qdrant/qdrant

# Проверка
curl http://localhost:6333/healthz
```

### Вариант 3: Docker Compose

Создайте `docker-compose.yml`:

```yaml
version: '3.8'

services:
  qdrant:
    image: qdrant/qdrant:latest
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - ./qdrant_storage:/qdrant/storage
    environment:
      - QDRANT__SERVICE__GRPC_PORT=6334
    restart: unless-stopped

  app:
    build: .
    ports:
      - "8000:8000"
    environment:
      - QDRANT_HOST=qdrant
      - QDRANT_PORT=6333
    depends_on:
      - qdrant
```

Запуск:

```bash
docker-compose up -d
```

## Запуск приложения

### Development (с auto-reload)

```bash
uvicorn src.main:app --reload --host 0.0.0.0 --port 8000
```

### Production

```bash
uvicorn src.main:app --host 0.0.0.0 --port 8000 --workers 4
```

### С Gunicorn (production)

```bash
pip install gunicorn
gunicorn src.main:app -w 4 -k uvicorn.workers.UvicornWorker -b 0.0.0.0:8000
```

## Проверка работоспособности

### 1. Health Check

```bash
curl http://localhost:8000/health
```

Ожидаемый ответ:

```json
{
  "status": "healthy",
  "version": "0.1.0",
  "services": {
    "qdrant": {
      "status": "healthy",
      "latency_ms": 2.5
    }
  }
}
```

### 2. OpenAPI документация

Откройте в браузере:
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc
- OpenAPI JSON: http://localhost:8000/openapi.json

### 3. Создание тестовой коллекции

```bash
curl -X POST http://localhost:8000/api/v1/qdrant/collections \
  -H "Content-Type: application/json" \
  -d '{"name": "test", "vector_size": 128, "distance": "Cosine"}'
```

## Возможные проблемы

### Qdrant не доступен

```
QdrantConnectionError: Cannot connect to Qdrant
```

**Решение:**
1. Проверьте, запущен ли Qdrant: `docker ps` или проверьте `QDRANT_LOCAL_PATH`
2. Проверьте настройки `QDRANT_HOST` и `QDRANT_PORT`
3. Проверьте firewall/сеть

### Port already in use

```
[Errno 98] Address already in use
```

**Решение:**
```bash
# Найти процесс
lsof -i :8000

# Убить процесс
kill -9 <PID>

# Или использовать другой порт
uvicorn src.main:app --port 8001
```

### ImportError: No module named 'src'

**Решение:**

Убедитесь, что вы находитесь в корневой директории проекта и виртуальное окружение активировано:

```bash
cd qdrant-FastApi
source .venv/bin/activate
```

## Структура после установки

```
qdrant-FastApi/
├── .venv/                  # Виртуальное окружение
├── .env                    # Конфигурация (не в git)
├── .env.example            # Пример конфигурации
├── qdrant_storage/         # Локальное хранилище Qdrant
├── src/                    # Исходный код
├── tests/                  # Тесты
├── docs/                   # Документация
├── requirements.txt        # Зависимости
└── README.md
```

## Следующие шаги

- [Конфигурация](04_конфигурация.md) — все параметры настройки
- [API Reference](05_api_reference.md) — работа с API
- [Тестирование](10_тестирование.md) — запуск тестов
